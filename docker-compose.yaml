services:
  dashborg:
    build: .
    image: dashborg:latest
    container_name: dashborg
    ports:
      - "3157:8000"
    volumes:
      - ./source:/source:ro
      - ./destination:/destination
      - ~/.ssh:/root/.ssh:ro
      - ./config:/etc/borgmatic
      - ./data:/data  # Persistent database storage
      - ./mounts:/mounts  # FUSE mounts and extracts
    restart: unless-stopped
    tty: true
    stdin_open: true
    # FUSE support for mounting archives
    cap_add:
      - SYS_ADMIN
    devices:
      - /dev/fuse:/dev/fuse
    security_opt:
      - apparmor:unconfined